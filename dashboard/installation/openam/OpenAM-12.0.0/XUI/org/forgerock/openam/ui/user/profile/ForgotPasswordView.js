define("org/forgerock/openam/ui/user/profile/ForgotPasswordView",["org/forgerock/commons/ui/common/main/AbstractView","org/forgerock/commons/ui/common/main/ValidatorsManager","UserDelegate","org/forgerock/commons/ui/common/main/Configuration","org/forgerock/commons/ui/common/util/CookieHelper","org/forgerock/commons/ui/common/main/EventManager","org/forgerock/commons/ui/common/util/Constants","org/forgerock/commons/ui/common/util/UIUtils"],function(e,t,n,r,i,s,o,u){var a=e.extend({template:"templates/openam/ForgotPasswordTemplate.html",baseTemplate:"templates/common/MediumBaseTemplate.html",data:{},events:{"click #continue":"continueProcess","click #changePasswordButton":"changePassword",onValidate:"onValidate",customValidate:"customValidate","click .cancelButton":"cancel"},errorsHandlers:{"Bad Request":{status:"400"},"Not found":{status:"404"},Gone:{status:"410"},"Internal Server Error":{status:"500"},"Service Unavailable":{status:"503"}},render:function(e,n){this.data.urlParams=u.convertCurrentUrlToJSON().params,this.data.isStageOne=!0,this.data.urlParams&&(this.data.isStageOne=!1),this.parentRender(function(){t.bindValidators(this.$el)})},continueProcess:function(e){e.preventDefault(),$("#username").prop("readonly",!0);var t=this,r={username:$("#username").val(),subject:$.t("templates.user.ForgottenPasswordTemplate.emailSubject"),message:$.t("templates.user.ForgottenPasswordTemplate.emailMessage")},i=function(){t.$el.find("#step1").slideUp(),t.$el.find("#emailSent").slideDown()},s=function(e){t.$el.find("input[type=submit]").prop("disabled",!0),$("#username").prop("readonly",!1),t.displayError(e)};this.$el.find("input[type=submit]").prop("disabled",!0),n.doAction("forgotPassword",r,i,s,t.errorsHandlers)},changePassword:function(e){e.preventDefault(),$("#password").prop("readonly",!0),$("#passwordConfirm").prop("readonly",!0),this.$el.find("input[type=submit]").prop("disabled",!0);var t=this,r={userpassword:$("#password").val()},i=function(){$("#step2").slideUp(),$("#passwordChangeSuccess").fadeIn()},s=function(e){$("#password").prop("readonly",!1),$("#passwordConfirm").prop("readonly",!1),t.displayError(e)};_.extend(r,this.data.urlParams),n.doAction("forgotPasswordReset",r,i,s,t.errorsHandlers)},cancel:function(e){e.preventDefault();var t=i.getCookie("loginUrlParams");i.deleteCookie("loginUrlParams"),location.href="#login"+(t?t:r.globalData.auth.realm)},customValidate:function(){t.formValidated(this.$el.find("#passwordChange"))||t.formValidated(this.$el.find("#forgotPassword"))?this.$el.find("input[type=submit]").prop("disabled",!1):this.$el.find("input[type=submit]").prop("disabled",!0)},displayError:function(e){var t="notFoundError",n=JSON.parse(e.responseText).message;switch(e.status){case 400:break;case 404:t="usernameNotFound";break;case 410:t="tokenNotFound";break;case 500:n==="No email provided in profile."?t="noEmailProvided":t="internalError";break;case 503:t="serviceUnavailable"}s.sendEvent(o.EVENT_DISPLAY_MESSAGE_REQUEST,t)}});return new a})