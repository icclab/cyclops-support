define("org/forgerock/openam/ui/user/oauth2/TokensView",["org/forgerock/commons/ui/common/main/AbstractView","org/forgerock/openam/ui/user/delegates/TokenDelegate","org/forgerock/commons/ui/common/main/EventManager","org/forgerock/commons/ui/common/util/Constants","dataTable","org/forgerock/commons/ui/common/main/i18nManager"],function(e,t,n,r,i,s){var o=e.extend({template:"templates/openam/oauth2/TokensTemplate.html",delegate:t,events:{"click checkbox":"select","click input[type=submit]":"formSubmit"},select:function(e){console.log("oauth2 token selected"),e.stopPropagation()},render:function(e,t){this.parentRender(function(){this.reloadData(),t&&t()})},reloadData:function(){$("#tokensTable").dataTable({bProcessing:!0,sAjaxSource:"",fnServerData:function(e,n,r,i){t.getAllTokens(function(e){var t={aaData:e},n,i,s;for(n=0;n<t.aaData.length;n++)t.aaData[n].selector='<input name="selector" id="'+t.aaData[n].id+'" type="checkbox" />',typeof t.aaData[n].scope!="undefined"?i=t.aaData[n].scope:i="-",t.aaData[n].cleanScope=$('<span class="cleanScope" />').text(i).wrap("<p>").parent().html(),s=new Date(Number(t.aaData[n].expireTime)),t.aaData[n].cleanDate=$('<span class="cleanDate" />').text(s).wrap("<p>").parent().html();r(t)})},aoColumns:[{mData:"selector",bSortable:!1},{mData:"clientID",sTitle:$.t("templates.oauth.clientID")},{mData:"id",sTitle:$.t("templates.oauth.tokenID")},{mData:"cleanScope",sTitle:$.t("templates.oauth.scope")},{mData:"cleanDate",sTitle:$.t("templates.oauth.expireDate")},{mData:"tokenName",sTitle:$.t("templates.oauth.tokenType")}],oLanguage:{sUrl:"locales/"+s.language+"/translation.json"},sDom:'l<"deleteSelected">f<"clear">rt<"clear">ip<"clear">',sPaginationType:"full_numbers",fnInitComplete:function(e,t){$(".deleteSelected").html('<input type="submit" class="button orange floatRight" value="'+$.t("common.form.deleteSelected")+'" >')},fnRowCallback:function(e,n,r){return $(e).children().not(":first").click(function(){var r=n.id[0],i,s,o=e,u;t.getTokenByID(function(e){var t;t='<table width="100%" cellpadding="5" cellspacing="0" border="0" style="padding:25px;">',e.realm&&(t+="<tr><td>"+$.t("templates.oauth.realm")+"</td><td>"+e.realm+"</td></tr>"),e.refreshToken&&(t+="<tr><td>"+$.t("templates.oauth.refreshToken")+"</td><td>"+e.refreshToken+"</td></tr>"),e.redirectURI&&(t+="<tr><td>"+$.t("templates.oauth.redirectURI")+"</td><td>"+e.redirectURI+"</td></tr>"),e.userName&&(t+="<tr><td>"+$.t("templates.oauth.username")+"</td><td>"+e.userName+"</td></tr>"),e.parent&&(t+="<tr><td>"+$.t("templates.oauth.parent")+"</td><td>"+e.parent+"</td></tr>"),t+="</table>",u=$(o).next().children(0),u.attr("class")==="details"&&u.html(t)},null,r),s=$("#tokensTable").dataTable(),s.fnIsOpen(e)?s.fnClose(e):s.fnOpen(e,i,"details")}),e}})},formSubmit:function(e){var n={};e.preventDefault(),e.stopPropagation(),$("input:checked",$("#tokensTable").dataTable().fnGetNodes()).each(function(){var e,n;n=$(this),e=n.attr("id"),t.deleteToken(function(e){console.info("Token Deleted id:",e),location.reload(!0)},function(e){console.error("Unable to delete token id:",e)},e)})}});return new o})