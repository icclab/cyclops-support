define("org/forgerock/openam/ui/user/login/RESTLoginHelper",["org/forgerock/openam/ui/user/delegates/AuthNDelegate","UserDelegate","org/forgerock/commons/ui/common/main/ViewManager","org/forgerock/commons/ui/common/main/AbstractConfigurationAware","org/forgerock/commons/ui/common/main/Router","org/forgerock/commons/ui/common/main/Configuration","org/forgerock/commons/ui/common/util/UIUtils","org/forgerock/commons/ui/common/util/Constants","org/forgerock/openam/ui/user/delegates/SessionDelegate","org/forgerock/commons/ui/common/util/CookieHelper"],function(e,t,n,r,i,s,o,u,a,f){var l=new r;return l.login=function(t,r,i){var o=this;e.getRequirements().done(function(u){var a=_.clone(u);t.userName&&t.password&&u.stage==="DataStore1"?(a.callbacks[0].input[0].value=t.userName,a.callbacks[1].input[0].value=t.password):_.each(u.callbacks,function(e,n){t.hasOwnProperty("callback_"+n)&&(a.callbacks[n].input[0].value=t["callback_"+n])}),e.submitRequirements(a).then(function(t){t.hasOwnProperty("tokenId")?l.getLoggedUser(function(n){s.setProperty("loggedUser",n),o.setSuccessURL(t.tokenId).then(function(){r(n),e.resetProcess()})},i):t.hasOwnProperty("authId")&&(n.currentView==="LoginView"?n.refresh():location.href="#login"+s.globalData.auth.realm)},function(e,t){e>1&&n.refresh(),i(t)})})},l.getLoggedUser=function(e,n){try{t.getProfile(function(r){s.globalData.auth.realm=r.userid.realm,i.configuration.routes.login.defaults[0]=r.userid.realm,t.getUserById(r.userid.id,r.userid.realm,e,function(e){e.responseJSON.code===404?n("loggedIn"):n()},{"Not Found":{status:"404"}})},function(){l.removeSessionCookie(),s.globalData.auth.realm||(s.globalData.auth.realm=i.configuration.routes.login.defaults[0]),n()},{serverError:{status:"503"},unauthorized:{status:"401"}})}catch(r){console.log(r),n()}},l.getLoginUrlParams=function(){var e=s.globalData.auth.fullLoginURL;return o.convertQueryParametersToJSON(e.substring(e.indexOf("?")+1))},l.setSuccessURL=function(t){var n=$.Deferred(),r=o.convertCurrentUrlToJSON().params,i=s.globalData.auth.successURL,a="";if(r&&r.goto)e.setGoToUrl(t,r.goto).then(function(e){e.successURL.startsWith("/")&&!e.successURL.startsWith("/"+u.context)&&(a="/"+u.context),s.globalData.auth.urlParams.goto=a+e.successURL,n.resolve()},function(){n.reject()});else{if(i!==u.CONSOLE_PATH||_.contains(_.map(u.CONSOLE_USERS,function(e){return e.toLowerCase()}),s.loggedUser.username.toLowerCase()))s.globalData.auth.urlParams||(s.globalData.auth.urlParams={}),s.globalData.auth.urlParams.goto||(s.globalData.auth.urlParams.goto=i);n.resolve()}return n},l.filterUrlParams=function(e){var t=["arg","authIndexType","authIndexValue","goto","gotoOnFail","ForceAuth","locale"],n={};return _.each(t,function(t){e[t]&&(n[t]=e[t])}),$.isEmptyObject(n)?"":"&"+$.param(n)},l.logout=function(e,t){var n=this,r=f.getCookie(s.globalData.auth.cookieName);a.isSessionValid(r).then(function(n){n.valid?a.logout(r).then(function(){return l.removeSessionCookie(),e(),!0},l.removeSessionCookie):(l.removeSessionCookie(),t&&t())},function(){t&&t()})},l.removeSession=function(){var e=f.getCookie(s.globalData.auth.cookieName);a.isSessionValid(e).then(function(t){t.valid&&a.logout(e).then(function(){l.removeSessionCookie()})})},l.removeSessionCookie=function(){_.each(s.globalData.auth.cookieDomains,function(e){f.deleteCookie(s.globalData.auth.cookieName,"/",e)})},l})