define("org/forgerock/openam/ui/user/profile/ChangeSecurityDataDialog",["org/forgerock/commons/ui/common/components/Dialog","org/forgerock/commons/ui/common/main/ValidatorsManager","org/forgerock/commons/ui/common/main/Configuration","UserDelegate","org/forgerock/commons/ui/common/util/UIUtils","org/forgerock/commons/ui/common/main/EventManager","org/forgerock/commons/ui/common/util/Constants"],function(e,t,n,r,i,s,o){var u=e.extend({contentTemplate:"templates/openam/ChangeSecurityDataDialogTemplate.html",data:{},events:{"click input[type=submit]":"formSubmit",onValidate:"onValidate",customValidate:"customValidate","click .dialogCloseCross img":"close","click input[name='close']":"close","click .dialogContainer":"stop"},errorsHandlers:{"Bad Request":{status:"400"}},formSubmit:function(e){var r={},i=this;e.preventDefault(),t.formValidated(this.$el.find("#passwordChange"))&&(r.username=form2js("content",".",!1).uid,r.currentpassword=this.$el.find("#currentPassword").val(),r.userpassword=this.$el.find("#password").val(),this.delegate.changePassword(n.loggedUser,r,_.bind(function(){s.sendEvent(o.EVENT_DISPLAY_MESSAGE_REQUEST,"securityDataChanged"),i.close()},this),function(e){JSON.parse(e.responseText).message==="Invalid Password"&&(s.sendEvent(o.EVENT_DISPLAY_MESSAGE_REQUEST,"invalidOldPassword"),i.close())},i.errorsHandlers))},customValidate:function(){t.formValidated(this.$el.find("#passwordChange"))||t.formValidated(this.$el.find("#securityDataChange"))?this.$el.find("input[type=submit]").prop("disabled",!1):this.$el.find("input[type=submit]").prop("disabled",!0)},render:function(){this.actions=[],this.addAction($.t("common.form.update"),"submit"),this.delegate=r,$("#dialogs").hide(),this.show(_.bind(function(){t.bindValidators(this.$el),$("#dialogs").show(),this.reloadData()},this))},reloadData:function(){this.$el.find("input[name=_id]").val(n.loggedUser.name),this.$el.find("input[type=submit]").prop("disabled",!0)}});return new u})