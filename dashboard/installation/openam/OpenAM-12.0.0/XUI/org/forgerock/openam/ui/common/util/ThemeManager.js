define("ThemeManager",["org/forgerock/openam/ui/common/util/Constants","org/forgerock/commons/ui/common/main/Configuration"],function(e,t){var n={},r,i;return n.loadThemeCSS=function(t){return r===undefined&&($("head").find("link[href*=less]").remove(),$("head").find("link[href*=favicon]").remove(),$("<link/>",{rel:"stylesheet/less",type:"text/css",href:e.BASE_PATH+t.path+"css/styles.less"}).appendTo("head"),$("<link/>",{rel:"icon",type:"image/x-icon",href:e.BASE_PATH+t.path+t.icon}).appendTo("head"),$("<link/>",{rel:"shortcut icon",type:"image/x-icon",href:e.BASE_PATH+t.path+t.icon}).appendTo("head"),r=$.ajax({url:e.BASE_PATH+e.LESS_VERSION,dataType:"script",cache:!0,error:function(e,t,n){console.log(e.responseText)}})),r},n.loadThemeConfig=function(){return i===undefined&&(i=$.getJSON(e.BASE_PATH+e.THEME_CONFIG_PATH)),i},n.getTheme=function(){var e={},r={},i,s,o;return t.globalData.theme&&n.mapRealmToTheme()===t.globalData.theme.name?(s=$.Deferred(),s.resolve(t.globalData.theme),s):n.loadThemeConfig().then(function(s){return n.data=s,t.globalData.themeConfig=s,i=n.mapRealmToTheme(),e=_.reject(n.data.themes,function(e){return e.name!==i})[0],e.name!=="default"&&e.path===""&&(o=_.reject(n.data.themes,function(e){return e.name!=="default"})[0],e=$.extend(!0,{},o,e)),t.globalData.auth.realm?n.loadThemeCSS(e).then(function(){return _.each(e.settings.lessVars,function(e,t){r["@"+t]=e}),less.modifyVars(r),t.globalData.theme=e,e}):n.getTheme()})},n.mapRealmToTheme=function(){var e,r="default";return t.globalData.auth.realm&&t.globalData.auth.realm.substring(1).length!==0?e=t.globalData.auth.realm.substring(1):e=document.domain,_.each(n.data.themes,function(t){_.each(t.realms,function(n){if(t.regex){var i=new RegExp(n);if(i.test(e))return r=t.name,!1}else if(n===e)return r=t.name,!1})}),r},n})