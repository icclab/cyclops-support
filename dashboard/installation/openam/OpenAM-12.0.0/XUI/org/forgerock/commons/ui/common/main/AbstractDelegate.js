define("org/forgerock/commons/ui/common/main/AbstractDelegate",["org/forgerock/commons/ui/common/util/Constants","org/forgerock/commons/ui/common/main/Configuration","org/forgerock/commons/ui/common/main/ServiceInvoker"],function(e,t,n){var r=function(n){var r=new RegExp("^/"+e.context+"/([\\w/]*)"),i=n.match(r);this.serviceUrl=n,i&&i.length>1&&(this.baseEntity=i[1])};return r.prototype.serviceCall=function(r){return r.hasOwnProperty("headers")||(r.headers={}),t.hasOwnProperty("passwords")&&t.passwords.hasOwnProperty("password")&&(r.headers[e.HEADER_PARAM_REAUTH]=t.passwords.password),r.serviceUrl?r.url=r.serviceUrl+r.url:r.url=this.serviceUrl+r.url,n.restCall(r)},r.prototype.createEntity=function(e,t,n,r){console.debug("create entity");var i={};if(typeof e=="object"&&e!==null)throw"Invalid id value passed to createEntity";return e!==null&&e!==undefined?(t._rev?i["If-None-Match"]='"'+t._rev+'"':i["If-None-Match"]='"*"',this.serviceCall({url:"/"+e,type:"PUT",success:n,error:r,data:JSON.stringify(t),headers:i})):this.serviceCall({url:"?_action=create",type:"POST",success:n,error:r,data:JSON.stringify(t),headers:i})},r.prototype.deleteEntity=function(e,t,n){console.debug("delete entity");var r=this;return this.readEntity(e,function(i){var s={url:"/"+e,type:"DELETE",success:t,error:n};i._rev&&(s.headers=[],s.headers["If-Match"]='"'+i._rev+'"'),r.serviceCall(s)},n)},r.prototype.readEntity=function(e,t,n){return console.debug("get entity"),this.serviceCall({url:"/"+e,type:"GET",success:t,error:n})},r.prototype.updateEntity=function(e,t,n,r){console.debug("update entity");var i={};return t._rev?i["If-Match"]='"'+t._rev+'"':i["If-Match"]='"*"',this.serviceCall({url:"/"+e,type:"PUT",success:n,error:r,data:JSON.stringify(t),headers:i})},r.prototype.patchEntityDifferences=function(e,t,n,r,i,s,o){console.debug("patching entity");var u=this.getDifferences(t,n);if(!u.length){console.debug("No changes detected"),s&&s();return}return this.patchEntity(e,u,r,i,s,o)},r.prototype.patchEntity=function(e,t,n,r,i,s){var o;for(o=0;o<t.length;o++)typeof t[o].field!="undefined"&&(t[o].field="/"+t[o].field);return this.serviceCall({url:"/"+e.id,type:"PATCH",success:n,error:r,data:JSON.stringify(t),headers:{"If-Match":'"'+e.rev+'"'},errorsHandlers:s})},r.prototype.patchEntityAttribute=function(e,t,n,r,i,s){return this.patchEntity(e,[{operation:"replace",field:t,value:n}],r,i,s)},r.prototype.getDifferences=function(e,t,n){var r,i,s,o,u=[],a={};n||(n="replace");for(s in t)o=t[s],typeof o!="function"&&(r=t[s],i=e[s],(r!==""||i)&&r!==i&&(a={operation:n,field:s,value:r},u.push(a)));return u},r})