define("org/forgerock/commons/ui/common/LoginDialog",["jquery","underscore","org/forgerock/commons/ui/common/main/ValidatorsManager","org/forgerock/commons/ui/common/main/Configuration","org/forgerock/commons/ui/common/main/EventManager","org/forgerock/commons/ui/common/util/Constants","org/forgerock/commons/ui/common/components/Dialog","org/forgerock/commons/ui/common/main/SessionManager","org/forgerock/commons/ui/common/main/ViewManager"],function(e,t,n,r,i,s,o,u,a){var f=o.extend({contentTemplate:"templates/common/LoginDialog.html",element:"#dialogs",events:{"click input[type=submit]":"login","click .dialogCloseCross img":"loginClose","click input[name='close']":"loginClose","click .dialogContainer":"stop",onValidate:"onValidate","keypress input":"submitForm"},displayed:!1,submitForm:function(e){e.which===13&&this.login(e)},render:function(){this.displayed===!1&&(this.displayed=!0,this.addAction("Login","submit"),this.show(t.bind(function(){n.bindValidators(this.$el),e(".dialog-background").off("click").on("click",t.bind(this.loginClose,this)),r.loggedUser&&r.loggedUser.userName?(e("input[name=login]").val(r.loggedUser.userName).trigger("keyup"),e("input[name=password]").focus()):e("input[name=login]").focus()},this)))},loginClose:function(e){e&&e.preventDefault(),this.displayed=!1,this.close(e)},login:function(e){e.preventDefault();if(n.formValidated(this.$el)){var t,o,f,l=this;t=this.$el.find("input[name=login]").val(),o=this.$el.find("input[name=password]").val(),f=this.$el.find("input[name=refreshOnLogin]:checked").val(),u.login({userName:t,password:o},function(e){r.setProperty("loggedUser",e),i.sendEvent(s.EVENT_AUTHENTICATION_DATA_CHANGED,{anonymousMode:!1}),i.sendEvent(s.EVENT_DISPLAY_MESSAGE_REQUEST,"loggedIn"),l.loginClose(),f&&a.refresh()},function(){i.sendEvent(s.EVENT_DISPLAY_MESSAGE_REQUEST,"authenticationFailed")})}},data:{height:200,width:400}});return new f})