define("org/forgerock/commons/ui/common/main/Router",["org/forgerock/commons/ui/common/main/EventManager","org/forgerock/commons/ui/common/util/Constants","org/forgerock/commons/ui/common/main/Configuration","org/forgerock/commons/ui/common/main/AbstractConfigurationAware"],function(e,t,n,r){var i=new r;return i.bindedRoutes={},i.currentRoute={},i.checkRole=function(r){if(r.role)if(!n.loggedUser||!_.find(r.role.split(","),function(e){return n.loggedUser.roles.indexOf(e)!==-1}))return e.sendEvent(t.EVENT_UNAUTHORIZED),!1;return r.excludedRole&&n.loggedUser&&n.loggedUser.roles.indexOf(r.excludedRole)!==-1?(e.sendEvent(t.EVENT_UNAUTHORIZED),!1):!0},i.init=function(){console.debug("Router init");var n=Backbone.Router.extend({initialize:function(e){var t,n;for(t in e)n=e[t].url,this.route(n,t,_.bind(this.processRoute,{key:t})),i.bindedRoutes[t]=_.bind(this.processRoute,{key:t})},processRoute:function(){var n=i.configuration.routes[this.key],r,s,o;o=_.toArray(arguments);if(!i.checkRole(n))return;n.event?e.sendEvent(n.event,o):n.dialog?(n.baseView=i.configuration.routes[n.base],e.sendEvent(t.EVENT_SHOW_DIALOG,{route:n,args:o,base:n.base})):n.view&&e.sendEvent(t.EVENT_CHANGE_VIEW,{route:n,args:o})}});i.router=new n(i.configuration.routes),Backbone.history.start()},i.routeTo=function(e,t){var n;t&&t.args?n=i.getLink(e,t.args):n=e.url,t.replace=!1,i.currentRoute=e,i.router.navigate(n,t)},i.execRouteHandler=function(e){i.bindedRoutes[e]()},i.navigate=function(e,t){i.router.navigate(e,t)},i.getLink=function(e,t){var n,r,i;if(typeof e.defaults=="object")if(t){r=t.length>=e.defaults.length?t.length:e.defaults.length;for(n=0;n<r;n++)typeof t[n]!="string"&&e.defaults[n]!==undefined&&(t[n]=e.defaults[n])}else t=e.defaults;_.isRegExp(e.url)?i=e.pattern:i=e.url.replace(/:[A-Za-z@.]+/,"?");if(t){for(n=0;n<t.length;n++){if(t[n]===undefined)break;i=i.replace("?",t[n])}i=i.replace(/\?/g,"")}return i},i})